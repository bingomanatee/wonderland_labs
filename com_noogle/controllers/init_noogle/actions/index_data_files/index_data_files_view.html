<form method="post" class="wizard form" xmlns="http://www.w3.org/1999/html"><h1>Initilaize Noogle</h1>
    <%- partial("../../views/step_header.html", {step: "index_data_files"}) %> <br/>

    <h2>Index Data Files</h2>

    <fieldset id="load-index-controls">
        <legend>Scope</legend>
        <label class="radio" style="display: inline-block; width: 12em"><input checked="checked" name="scope"
                                                                               type="radio" value="1"/>&nbsp;one
            file</label>
        <label class="radio" style="display: inline-block; width: 12em"><input name="scope" type="radio"
                                                                               value="10"/>&nbsp;ten
            files</label>

        <br />

        <label class="radio" style="display: inline-block; width: 12em"><input name="scope" type="radio"
                                                                               value="100"/>&nbsp;a hundred
            files</label>
        <label class="radio" style="display: inline-block; width: 12em"><input name="scope" type="radio"
                                                                               value="1000"/>&nbsp;a thousand
            files</label>
        <label class="radio" style="display: inline-block; width: 12em"><input name="scope" type="radio"
                                                                               value="all"/>&nbsp;<b>all</b>
            files</label>
        <button class="btn btn-primary" onclick="return NOOGLE.load_indexes()">Load Indexes</button>
        <br />
        <br />
    </fieldset>

    <table class="table" border="0" cellpadding="0" cellspacing="0">
        <thead>
        <tr>
            <th class="right">#</th>
            <th class="right">Date</th>
            <th class="right">File</th>
            <th class="right">Host</th>
            <th class="right">Size</th>
        </tr>
        </thead>
        <tbody id="file_rows">
        <tr><td colspan=5 class="placeholder_cell"></td></tr>
        </tbody>
    </table>

    <% if (files){ %>
<h3>Files Already Indexed</h3>


    <table class="table" border="0" cellpadding="0" cellspacing="0">
        <thead>
        <tr>
            <th class="right">#</th>
            <th class="right d">Date</th>
            <th class="">File</th>
            <th class="d">Host</th>
            <th class="right">Size</th>
        </tr>
        </thead>
        <tbody style="max-height: 40em; overflow: scroll">
        <% files.forEach(function(file){ %>
        <tr><td class="right"><%= file._id %></td>
        <td class="right d"><%= file.file.split('.')[0] %></td>
        <td class=""><%= file.domain %>/<%= file.file %></td>
            <td class="d">http://<%= file.domain %></td>
            <td class="right">big</td>
        </tr>
        <% }) %>
        </tbody>
    </table>

    <% } %>
    <%- partial("../../views/step_footer.html", {step: "index_data_files"}) %>
</form>
<!-- Modal -->
<div class="modal" id="loading-modal" tabindex="-1" role="dialog"
     aria-labelledby="myModalLabel" aria-hidden="true" style="display: none">
  <div class="modal-header">
    <h3 id="myModalLabel">Loading Index Files</h3>
  </div>
  <div class="modal-body">
    <p>We are currently loading index files.</p>
      <p>Please wait for us to complete this step.</p>
  </div>
  <div class="modal-footer">
    <button class="btn btn-primary continue-btn" onclick=" $('#loading-modal').modal('hide');return false" style="display: none">Continue</button>
  </div>
</div>


<script language="javascript">
    var NOOGLE = {

        load_indexes:function () {
           // $('.placeholder_cell').html('<b style="color: red">It may take a while to load the content pages. Please be patient and do not click on anything.</b>')
            $('#loading-modal').modal();
            $("#load-index-controls").hide();

            var wizard_vals = _.reduce($('form.wizard').serializeArray(), function (m, r) {
                m[r.name] = r.value;
                return m;
            }, {});

            console.log(wizard_vals);

            function _with_files(data) {
                $('#loading-modal .continue-btn').show();
                $('#loading-modal .modal-body').html('<p>Thanks for your patience. Your content has now loaded.</p>');
                setTimeout(function(){
                    $('#loading-modal').modal('hide');
                },3000);
                try {
                    var j = (typeof data == 'string') ? JSON.parse(data) : data;
                } catch (err) {
                    return console.log('cannot parse ', data);
                }

                var row_ele = $('#file_rows');
                row_ele.empty();
                $.each(j, function (i, file) {
                    row_ele.append('<tr>' +
                            '<th class="right">' + (i + 1) + '</th>' +
                            '<td class="right d">' + file.base + '</td>' +
                            '<td class="right" nowrap="nowrap">' + file.file + '</td>' +
                            '<td class="right">' + Math.floor(parseInt(file.size)/1024) + ' K</td>' +
                            '</tr>');
                });

            }


            try {
                $.get('/noogle/load_indexes/' + wizard_vals.scope, _with_files);


            } catch (oops) {
                console.log(oops);
            }

            return false;
        }

    }
</script>
<style>
    td.right {
        text-align: right !important;
    }
    .d {
        background-color: rgba(0,0,0,0.1);
    }
</style>