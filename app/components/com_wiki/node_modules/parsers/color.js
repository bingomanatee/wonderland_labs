var _ = require('underscore');

/*
 * Sets the color of a block of text
 */


module.exports = function (text, article, cb) {
    var re = /<c ([\w]+)([^>]*)>/g;
    var hits = text.match(re);

        if (hits && hits.length) {

            function color_parts(links) {
                return _.map(links, function (link) {
                    var e = re.exec(link);
                    if (!e) return false;
                    return {color:e[1], original:link};
                })
            }

            var parts = color_parts( _.uniq(hits));

            parts.forEach(function (part) {
                console.log('searching for ', part.original);
                var repl = '<c style="color: ' + part.color + '">';

                do {
                    text = text.replace(part.original, repl);
                }   while (text.indexOf(part.original) > -1)
            })
        }

        cb(null, text, article);
    }