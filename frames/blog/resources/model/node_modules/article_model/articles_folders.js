var _ = require('underscore');
var util = require('util');
var path = require('path');
var fs = require('fs');
var _DEBUG = false;
var Gate = require('gate');
var article_dir = require('./article_dir');

/* ************************************
 * 
 * ************************************ */

/* ******* CLOSURE ********* */

/* ********* EXPORTS ******** */

module.exports = function articles_folders(cb) {
	fs.readdir(article_dir(), function (err, files) {
		var gate = Gate.create();
		var folders = [];

		if (err) {
			return cb(err);
		}

		files = _.reject(files, function (file) {
			return /^\./.test(file);
		});

		files.forEach(function (file) {
			var full_path = path.resolve(article_dir(), file);
			var l = gate.latch();

			fs.stat(full_path, function (err, stat) {
				if (stat.isDirectory()) {
					folders.push(file);
				}
				l();
			})
		})

		gate.await(function () {
			cb(null, folders);
		})
	})
};