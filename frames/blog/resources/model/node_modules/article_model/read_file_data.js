var _ = require('underscore');
var util = require('util');
var path = require('path');
var fs = require('fs');
var _DEBUG = false;
var Gate = require('gate');

/* ************************************
 * 
 * ************************************ */

/* ******* CLOSURE ********* */

/* ********* EXPORTS ******** */

module.exports = function (cache, done) {

	var gate = Gate.create();

	// file data is the data for a single file
	_.each(cache, function (file_data) {

		var l = gate.latch();
		fs.readFile(file_data.meta_path, 'utf8', function (err, meta) {
			try {
				meta = JSON.parse(meta);
				_.extend(file_data, meta);
			} catch (err) {
			}
			l();
		})

	});

	gate.await(done);

}; // end export function