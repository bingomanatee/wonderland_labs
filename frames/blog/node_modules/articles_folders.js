var _ = require('underscore');
var util = require('util');
var path = require('path');
var fs = require('fs');
var _DEBUG = false;
var Gate = require('gate');

/* ************************************
 * 
 * ************************************ */

/* ******* CLOSURE ********* */

var ARTICLES_FOLDER = path.resolve(__dirname, '../articles');

/* ********* EXPORTS ******** */

module.exports = function (cb) {
	fs.readdir(ARTICLES_FOLDER, function(err, files){
		var gate = Gate.create();
		var folders = [];

		files.forEach(function(file){
			var full_path = path.resolve(ARTICLES_FOLDER, file);
			var l = gate.latch();

			fs.stat(full_path, function(err, stat){
				if (stat.isDirectory()){
					folders.push(file);
				}
				l();
			})
		})

		gate.await(function(){
			console.log('done scanning %s, found %s', ARTICLES_FOLDER, folders.join(', '));

			cb(null, folders);
		})
	})
}; // end export function